(function(R,$){typeof exports=="object"&&typeof module<"u"?module.exports=$():typeof define=="function"&&define.amd?define($):(R=typeof globalThis<"u"?globalThis:R||self,R.typeahead=$())})(this,function(){"use strict";const R=(...r)=>{},$=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Y=r=>r!==null&&r?.constructor.name==="Object",ce=r=>typeof r=="string",S=(r,i)=>{let y=r;const D=i.split(".");for(const L of D){if(!Y(y)||!(L in y))return"";y=y[L]}return`${y}`},j=(r="")=>r.normalize("NFD").replace(/\p{Diacritic}/gu,""),P=(r,i)=>{if(!r.length)return[];if(Y(r[0])){for(const y of r)if(!S(y,i))throw new Error("e03");return r}return r.map(y=>({[i]:ce(y)?y:JSON.stringify(y)}))},le=r=>r.split(/\s+/),ve=async function(r,i){const y=await fetch(r,i||{method:"GET"});return be(y)},be=async function(r){const i=await r.text(),y=i&&JSON.parse(i);return r.ok?y:Promise.reject(y&&y.message||r.statusText)},ae={get:ve},we=(r={})=>{const{hasDiacritics:i,tokenizer:y}=r;let D={};const L="\0";function W(a=""){return a=`${a}`.trim(),i&&(a=j(a)),(y||le)(a.toLowerCase())}function B(a,E="",x){if(!a)return;let g;a=Array.isArray(a)?a:[a];const m=ce(a[0]);for(const T of a){const b=W(m?T:S(T,E));for(const v of b){if(!v)continue;g=D;for(const I of v)g=g[I]||(g[I]={});const d=m?T:x&&x(T)||JSON.stringify(T),Z=g[L]??(g[L]={});Z[d]=T}}}function o(a){let E=D;const x={};for(const m of a)if(E=E?.[m],typeof E>"u")return{};const g=[{node:E,prefix:a}];for(;g.length;){const{node:m,prefix:T}=g.pop();for(const b in m)if(b===L){const v=m[L];for(const d in v)x[d]=v[d]}else g.push({node:m[b],prefix:T+b})}return x}const q=(a,E)=>{const x={};for(const g in a)g in E&&(x[g]=a[g]);return x};function H(a,E){const x=W(a),g=x.length<=20?x.length:20;let m=o(x[0]);for(let b=1;b<g&&(m=q(m,o(x[b])),!!Object.keys(m).length);b++);m=Object.values(m);const T=m.length;return E&&T>E&&(m.length=E),{suggestions:m,count:T}}function J(){D={}}return{add:B,clear:J,search:H}};return r=>{if(!r.input)throw new Error("e01");if(!Y(r.source))throw new Error("e02");const i=document.createElement("div"),y=r.preventSubmit||!1,D=r.minLength||1,L=r.hint!==!1,W=r.autoSelect||!1,B=r.tokenizer||le,o=r.templates,q=Array.isArray(r.source.keys)?r.source.keys:["label"],H=r.source.groupKey||"",J=e=>S(e,q[0]),a=r.display||J,E=r.source.identity||J,x=r.onSubmit||R,g=r.source.transform||(e=>e),m=r.source.local||null,T=typeof r.source.remote?.url,b=T==="function"||T==="string"&&r.source.remote.wildcard?r.source.remote:null,v=r.source.prefetch?.url?{when:"onInit",done:!1,...r.source.prefetch}:null,d={wrapper:"typeahead-standalone",input:"tt-input",hint:"tt-hint",highlight:"tt-highlight",hide:"tt-hide",show:"tt-show",list:"tt-list",selected:"tt-selected",header:"tt-header",footer:"tt-footer",loader:"tt-loader",suggestion:"tt-suggestion",group:"tt-group",empty:"tt-empty",notFound:"tt-notFound",...r.classNames||{}},Z={block:"nearest",...r.listScrollOptions||{}},I={updateHits:r.hooks?.updateHits||R};if(!m&&!v&&!b)throw new Error("e02");const ee=we({hasDiacritics:r.diacritics,tokenizer:B}),z=document.createElement("div");z.className=d.wrapper;const n={query:"",hits:[],count:0,limit:r.limit||5,wrapper:z};let V={},_={},f,te,N=!1,G="";o&&(o.header=typeof o.header=="function"?o.header:void 0,o.footer=typeof o.footer=="function"?o.footer:void 0,o.notFound=typeof o.notFound=="function"?o.notFound:void 0,o.group=typeof o.group=="function"?o.group:void 0,o.suggestion=typeof o.suggestion=="function"?o.suggestion:void 0,o.loader=typeof o.loader=="function"?o.loader:void 0,o.empty=typeof o.empty=="function"?o.empty:void 0);const K=(e=[])=>{ie(P(e,q[0]))};m&&K(m);const l=r.input;l.classList.add(d.input);const ue=window.getComputedStyle(l),Q=l.parentNode,Ee=[...Q.children].indexOf(l);Q.removeChild(l),z.appendChild(l),Q.insertBefore(z,Q.children[Ee]);const A=l.cloneNode(),xe=/^(x-|hx-|data-|@)/;for(let e=A.attributes.length-1;e>=0;e--)xe.test(A.attributes[e].name)&&A.removeAttribute(A.attributes[e].name);L&&Fe(A),i.classList.add(d.list,d.hide),i.setAttribute("aria-label","menu-options"),i.setAttribute("role","listbox"),i.style.position="absolute",i.style.width=`${l.offsetWidth}px`,i.style.marginTop=`${l.offsetHeight+parseInt(ue.marginTop)}px`,new ResizeObserver(e=>{for(const t of e)i.style.width=`${t.target.offsetWidth}px`}).observe(l),z.appendChild(i),v&&v.when==="onInit"&&de();function de(){if(!v||v.done)return;let e=[];ae.get(typeof v.url=="function"?v.url():v.url,v?.requestOptions).then(t=>{e=g(t),e=P(e,q[0]),ie(e)},t=>{console.error("e04",t)}).finally(()=>{typeof v.process=="function"&&v.process(e)}),v.done=!0}const M=()=>{i.classList.remove(d.hide)},Te=()=>{i.classList.add(d.hide)},ke=()=>!i.classList.contains(d.hide)&&!!Array.from(i.children).find(e=>e.classList.contains(d.suggestion)),fe=()=>te&&clearTimeout(te),O=()=>{n.hits=[],A.value="",G="",Te()},pe=()=>{l.dispatchEvent(new InputEvent("input",{bubbles:!0,inputType:"insertCompositionText",data:l.value}))},ne=(e=!1)=>{if(!n.hits.length&&n.query){O(),re();const t=o?.notFound?.(n);if(!t)return!0;const s=u=>{const h=document.createElement("div");h.classList.add(d.notFound),F(h,u),i.appendChild(h)};return b?(V[JSON.stringify(n.query)]||e&&!N)&&s(t):s(t),M(),!0}},re=()=>{for(;i.firstChild;)i.firstChild.remove()},se=(e=!0)=>{if(!o?.loader)return;const t=i.querySelector(`.${d.loader}`);if(!e){t&&i.removeChild(t);return}if(t)return;const s=document.createElement("div");s.classList.add(d.loader),F(s,o.loader()),o?.footer?i.insertBefore(s,i.querySelector(`.${d.footer}`)):i.appendChild(s),M()},U=async()=>{const e=await I.updateHits({hits:n.hits,query:n.query,count:n.count},se);if(e?.hits?.length&&(n.hits=e.hits,e.count&&(n.count=e.count),e.updateSearchIndex&&K(e.hits)),ne())return;re();const t=p=>{const c=document.createElement("div");return c.classList.add(d.suggestion),c.setAttribute("role","option"),c.setAttribute("aria-selected","false"),c.setAttribute("aria-label",a(p)),o?.suggestion?F(c,o.suggestion(p,n)):c.textContent=S(p,q[0]),c},s=p=>{const c=document.createElement("div");return c.classList.add(d.group),c.setAttribute("role","group"),c.setAttribute("aria-label",p),o?.group?F(c,o.group(p,n)):c.textContent=p||"",c},u=document.createDocumentFragment(),h=[];if(o?.header){const p=document.createElement("div");p.classList.add(d.header),p.setAttribute("role","presentation"),F(p,o.header(n))&&u.appendChild(p)}for(const[p,c]of n.hits.entries()){if(p===n.limit)break;const w=S(c,H);if(w&&!h.includes(w)){h.push(w);const C=s(w);u.appendChild(C)}const k=t(c);k.addEventListener("click",C=>{O(),f=c,l.value=a(c,C),pe()}),c===f&&(k.classList.add(d.selected),k.setAttribute("aria-selected","true")),u.appendChild(k),r.highlight!==!1&&Ne(k,n.query)}if(o?.footer){const p=document.createElement("div");p.classList.add(d.footer),p.setAttribute("role","presentation"),F(p,o.footer(n))&&u.appendChild(p)}i.appendChild(u),L&&Re(f||n.hits[0]),i.querySelector(`.${d.selected}`)?.scrollIntoView(Z),M()},Ce=e=>{typeof e.inputType>"u"||e.inputType==="insertCompositionText"&&!e.isComposing||(G=l.value,he())},Le=e=>{const t=n.hits.length>=n.limit?n.limit:n.hits.length;if(f===n.hits[0]){f=void 0,l.value=G;return}if(!f)f=n.hits[t-1];else for(let s=t-1;s>0;s--)if(f===n.hits[s]||s===1){f=n.hits[s-1];break}l.value=a(f,e)},qe=e=>{const t=n.hits.length>=n.limit?n.limit:n.hits.length;if(!f){f=n.hits[0],l.value=a(f,e);return}if(f===n.hits[t-1]){f=void 0,l.value=G;return}for(let s=0;s<t-1;s++)if(f===n.hits[s]){f=n.hits[s+1];break}l.value=a(f,e)},Se=e=>{if(e.key==="Escape"||!l.value.length&&!n.hits.length)return O();if(e.key==="Backspace"&&(f=void 0),n.hits.length&&(e.key==="ArrowUp"||e.key==="ArrowDown")){e.key==="ArrowDown"?qe(e):Le(e),U(),e.preventDefault(),e.stopPropagation();return}if(!n.query&&!l.value.length)return;const t=(s=!1)=>{if(!f&&s&&n.hits.length&&(f=n.hits[0]),f)return O(),l.value=a(f,e),pe(),f};if(e.key==="Enter"){y&&e.preventDefault(),x(e,t());return}e.key==="Tab"&&ke()&&(r.retainFocus!==!1&&e.preventDefault(),t(!0))},Ae=()=>{v?.when==="onFocus"&&de(),he()},he=async()=>{fe();const e=l.value.replace(/\s{2,}/g," ").trim();if(o?.empty&&!e.length){const t=o.empty(n);if(n.query="",Array.isArray(t)&&t.length)return n.hits=P(t,q[0]),await U();if(O(),re(),t){const s=document.createElement("div");s.classList.add(d.empty),F(s,`${t}`),i.appendChild(s)}return M()}if(e.length>=D){n.query=e,oe();const t=JSON.stringify(n.query);b&&n.hits.length<n.limit&&_[t]?.length&&oe(_[t]),U(),te=setTimeout(()=>{n.hits.length<n.limit&&!N&&ye()},b?.debounce||200)}else n.query="",O()},me=(e="")=>(r.diacritics&&(e=j(e)),e.toLowerCase()),oe=e=>{let{suggestions:t,count:s}=ee.search(n.query,n.limit);if(e?.length){e.push(...t);const u={};for(const h of e)u[E(h)]=h;t=Object.values(u),s=t.length}Oe(t),H&&De(t),n.hits=t,n.count=s,f=void 0,W&&n.hits.length&&(f=n.hits[0])},ye=()=>{if(!b)return;N=!0;const e=n.query,t=JSON.stringify(e);if(V[t]||!n.query.length){N=!1,ne(!0);return}se(N);let s=[];ae.get(typeof b.url=="function"?b.url(e):b.url.replace(b.wildcard,e),b.requestOptions).then(u=>{s=g(u),s=P(s,q[0]),ie(s)},u=>{console.error("e05",u)}).finally(()=>{V[t]=!0,_[t]=s||[],N=!1,se(N),s.length&&n.query.length&&(oe(s),U()),n.query.length&&e!==n.query&&ye(),ne(!0)})};function ie(e){if(e.length)for(const t of q)ee.add(e,t,E)}const Oe=e=>{const t=n.query.toLowerCase();e.sort((s,u)=>{const h=S(s,q[0]).toLowerCase(),p=S(u,q[0]).toLowerCase(),c=h.startsWith(t),w=p.startsWith(t);return c&&w?h.length-p.length:c?-1:w?1:0})},De=e=>{e.sort((t,s)=>{const u=S(t,H),h=S(s,H);return!u&&!h?0:u?h?u<h?-1:u>h?1:0:1:-1})},Ne=(e,t)=>{if(!t)return;const u=(c=>{const w=B(c.trim()).map(k=>$(k)).sort((k,C)=>C.length-k.length);return new RegExp(`(${w.join("|")})`,"i")})(t),h=c=>{let w=u.exec(c.data);if(r.diacritics&&!w&&(w=u.exec(j(c.data))),w){const k=document.createElement("span");k.className=d.highlight;const C=c.splitText(w.index);return C.splitText(w[0].length),k.appendChild(C.cloneNode(!0)),c.parentNode?.replaceChild(k,C),!0}return!1},p=(c,w)=>{let C;for(let X=0;X<c.childNodes.length;X++)C=c.childNodes[X],C.nodeType===3?X+=w(C)?1:0:p(C,w)};p(e,h)};function Fe(e){["id","name","placeholder","required","aria-label"].forEach(t=>e.removeAttribute(t)),e.setAttribute("readonly","true"),e.setAttribute("aria-hidden","true"),e.style.marginTop=`-${l.offsetHeight+parseInt(ue.marginBottom)}px`,e.tabIndex=-1,e.className=d.hint,l.after(e)}const Re=e=>{const t=l.value;if(!t||a(e)===t||me(a(e)).indexOf(me(t).replace(/\s{2,}/g," ").trimStart())!==0)A.value="";else{const s=a(e),u=new RegExp($(n.query),"i");let h=u.exec(s);r.diacritics&&!h&&(h=u.exec(j(s))),h&&(A.value=t.replace(/\s?$/,"")+s.substring(h[0].length))}},F=(e,t)=>{const s=document.createElement("template");return s.innerHTML=t,e.appendChild(s.content),t},$e=()=>{setTimeout(()=>{document.activeElement!==l&&O()},50)};i.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault()});const ge=e=>{O(),ee.clear(),m&&!e&&K(m),V={},_={},v&&(v.done=!1)},He=()=>{fe(),ge(),z.replaceWith(l.cloneNode())};return l.addEventListener("keydown",Se),l.addEventListener("input",Ce),l.addEventListener("blur",$e),l.addEventListener("focus",Ae),{addToIndex:K,reset:ge,destroy:He}}});
